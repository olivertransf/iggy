<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bell Schedule - This Week</title>
  <style>
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #f1f5f9; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .nav-bar { padding: 8px 12px; background: #fff; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 12px; flex-shrink: 0; }
    .nav-bar label { font-weight: 500; color: #374151; font-size: 14px; }
    .nav-bar select { padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; background: #fff; font-size: 14px; color: #111827; min-width: 200px; cursor: pointer; }
    .nav-bar select:hover, .nav-bar select:focus { border-color: #2563eb; outline: none; }
    .content-wrap { flex: 1; min-height: 0; display: flex; flex-direction: column; }
    .fit-container { overflow: auto; flex: 1; padding: 4px; }
    .fit-inner { display: flex; align-items: flex-start; justify-content: center; min-height: 100%; }
    .fit-wrapper { flex-shrink: 0; transform-origin: top center; box-shadow: 0 4px 24px rgba(0,0,0,.08); border-radius: 8px; overflow: hidden; background: #fff; }
    .fit-wrapper iframe { display: block; border: none; }
    .pdf-container { display: flex; flex-direction: column; align-items: center; gap: 0; }
    .pdf-container canvas { display: block; }
  </style>
</head>
<body style="display: flex; flex-direction: column;">
  <div class="nav-bar">
    <label for="week-select">Week:</label>
    <select id="week-select" aria-label="Select schedule week"></select>
  </div>
  <div class="content-wrap">
    <div class="fit-container">
      <div class="fit-inner" id="inner">
        <div class="fit-wrapper" id="wrapper">
          <iframe id="schedule" src="" title="Bell schedule"></iframe>
          <div id="pdf-container" class="pdf-container" style="display: none;"></div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    (function() {
      if (typeof pdfjsLib !== 'undefined') {
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
      }
      var WEEKS = [
        { file: 'SI Bell Schedule.pdf', label: 'Default Schedule (PDF)' },
        { file: 'Fall 2025.html', label: 'Fall 2025 (Overview)' },
        { file: 'Spring 2026.html', label: 'Spring 2026 (Overview)' },
        { file: 'Week of Jan 12.html', label: 'Week of Jan 12' },
        { file: 'Week of Jan 19.html', label: 'Week of Jan 19' },
        { file: 'Week of Feb 2.html', label: 'Week of Feb 2' },
        { file: 'Week of Feb 16.html', label: 'Week of Feb 16' },
        { file: 'Week of Mar 9.html', label: 'Week of Mar 9' },
        { file: 'Week of Mar 30.html', label: 'Week of Mar 30' },
        { file: 'Week of April 20.html', label: 'Week of April 20' },
        { file: 'Week of April 27.html', label: 'Week of April 27' },
        { file: 'Week of May 18.html', label: 'Week of May 18' },
        { file: 'Week of May 25.html', label: 'Week of May 25' },
        { file: 'Week of Aug 18.html', label: 'Week of Aug 18' },
        { file: 'Week of Sept 1.html', label: 'Week of Sept 1' },
        { file: 'Week of Sept 22.html', label: 'Week of Sept 22' },
        { file: 'Week of Sept 29.html', label: 'Week of Sept 29' },
        { file: 'Week of Oct 6.html', label: 'Week of Oct 6' },
        { file: 'Week of Oct 20.html', label: 'Week of Oct 20' },
        { file: 'Week of Nov 3.html', label: 'Week of Nov 3' },
        { file: 'Week of Nov 10.html', label: 'Week of Nov 10' },
        { file: 'Week of Dec 8.html', label: 'Week of Dec 8' },
        { file: 'Week of Dec 15.html', label: 'Week of Dec 15' }
      ];

      var DEFAULT_SCHEDULE = 'SI Bell Schedule.pdf';

      var iframe = document.getElementById('schedule');
      var wrapper = document.getElementById('wrapper');
      var select = document.getElementById('week-select');
      var pdfContainer = document.getElementById('pdf-container');
      var isPdf = false;

      function getMondayOfWeek(d) {
        var date = new Date(d);
        var day = date.getDay();
        var diff = date.getDate() - day + (day === 0 ? -6 : 1);
        return new Date(date.setDate(diff));
      }

      function formatWeekKey(d) {
        var months = ['Jan','Feb','Mar','April','May','June','July','Aug','Sept','Oct','Nov','Dec'];
        return 'Week of ' + months[d.getMonth()] + ' ' + d.getDate();
      }

      function getCurrentWeekFile() {
        var today = new Date();
        var monday = getMondayOfWeek(new Date(today.getFullYear(), today.getMonth(), today.getDate()));
        var weekKey = formatWeekKey(monday);
        for (var i = 2; i < WEEKS.length; i++) {
          if (WEEKS[i].label === weekKey) return WEEKS[i].file;
        }
        return DEFAULT_SCHEDULE;
      }

      function loadPdf(src) {
        isPdf = true;
        iframe.style.display = 'none';
        iframe.removeAttribute('src');
        pdfContainer.style.display = 'flex';
        pdfContainer.innerHTML = '';
        if (typeof pdfjsLib === 'undefined') {
          pdfContainer.textContent = 'Loading PDF viewerâ€¦';
          return;
        }
        pdfjsLib.getDocument(src).promise.then(function(pdf) {
          pdfContainer.textContent = '';
          var totalW = 0;
          var totalH = 0;
          var scale = 2;
          function renderPage(num) {
            if (num > pdf.numPages) {
              pdfContainer.style.width = totalW + 'px';
              pdfContainer.style.height = totalH + 'px';
              fit();
              return;
            }
            pdf.getPage(num).then(function(page) {
              var viewport = page.getViewport({ scale: scale });
              var canvas = document.createElement('canvas');
              var ctx = canvas.getContext('2d');
              canvas.height = viewport.height;
              canvas.width = viewport.width;
              totalW = Math.max(totalW, viewport.width);
              totalH += viewport.height;
              pdfContainer.appendChild(canvas);
              page.render({ canvasContext: ctx, viewport: viewport }).promise.then(function() {
                renderPage(num + 1);
              });
            });
          }
          renderPage(1);
        }).catch(function() {
          pdfContainer.textContent = 'Could not load PDF';
        });
      }

      function loadHtml(src) {
        isPdf = false;
        pdfContainer.style.display = 'none';
        pdfContainer.innerHTML = '';
        iframe.style.display = 'block';
        iframe.src = src;
        iframe.title = select.options[select.selectedIndex].text;
      }

      function loadContent(file) {
        if (file && file.toLowerCase().endsWith('.pdf')) {
          loadPdf(file);
        } else {
          loadHtml(file);
        }
      }

      function initSelect() {
        var params = new URLSearchParams(window.location.search);
        var chosen = params.get('week');
        var thisWeekFile = getCurrentWeekFile();
        if (!chosen) chosen = thisWeekFile;
        var hasExactWeek = WEEKS.some(function(w) { return w.file === thisWeekFile; });
        if (!hasExactWeek) {
          var opt0 = document.createElement('option');
          opt0.value = thisWeekFile;
          opt0.textContent = 'This week (default schedule)';
          if (chosen === thisWeekFile) opt0.selected = true;
          select.appendChild(opt0);
        }
        WEEKS.forEach(function(w) {
          var opt = document.createElement('option');
          opt.value = w.file;
          opt.textContent = w.label;
          if (w.file === chosen) opt.selected = true;
          select.appendChild(opt);
        });
        if (!select.value) select.selectedIndex = 0;
        iframe.title = select.options[select.selectedIndex].text;
        loadContent(chosen);
      }

      select.addEventListener('change', function() {
        var file = select.value;
        iframe.title = select.options[select.selectedIndex].text;
        loadContent(file);
        var url = new URL(window.location.href);
        url.searchParams.set('week', file);
        window.history.replaceState({}, '', url);
      });

      function getContentSize() {
        if (isPdf && pdfContainer.children.length > 0) {
          return { w: pdfContainer.offsetWidth || 1000, h: pdfContainer.offsetHeight || 640 };
        }
        try {
          var doc = iframe.contentDocument || iframe.contentWindow.document;
          var table = doc && doc.querySelector('.ritz .waffle');
          if (table) {
            return { w: table.offsetWidth || table.scrollWidth, h: table.offsetHeight || table.scrollHeight };
          }
          var grid = doc && doc.querySelector('.ritz.grid-container');
          if (grid) return { w: grid.scrollWidth, h: grid.scrollHeight };
        } catch (e) {}
        return { w: 1000, h: 640 };
      }

      function fit() {
        var containerPadding = 16;
        var vw = window.innerWidth - (containerPadding * 2);
        var vh = window.innerHeight - 60;
        var size = getContentSize();
        var scale = Math.min(vw / size.w, vh / size.h, 1);
        wrapper.style.transform = 'scale(' + scale + ')';
        if (!isPdf) {
          iframe.style.width = size.w + 'px';
          iframe.style.height = size.h + 'px';
        }
      }

      function injectCleanupStyles(doc) {
        if (!doc || !doc.body) return;
        doc.body.style.margin = '0';
        doc.body.style.overflow = 'hidden';
      }

      iframe.onload = function() {
        if (isPdf) return;
        try {
          var doc = iframe.contentDocument;
          if (doc) injectCleanupStyles(doc);
        } catch (e) {}
        fit();
        setTimeout(fit, 150);
        setTimeout(fit, 600);
      };
      window.addEventListener('resize', fit);
      initSelect();
    })();
  </script>
</body>
</html>
